<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exibição de Vídeos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        video {
            display: block;
            margin: 10px 0;
            max-width: 600px;
        }
        h4 {
            margin: 5px 0;
        }
    </style>
</head>
<body>

<h1>Vídeos Carregados</h1>
<div id="video-container"></div>

<script>
    let uri = "http://localhost:3000/course_video/66fe8e58a3a09a2810fbe4c6";
    async function fetchVideos() {
        try {
            const response = await fetch(uri); // Substitua pelo endpoint correto
            if (!response.ok) throw new Error('Erro ao buscar vídeos');
            
            const videos = await response.json();
            return videos;
        } catch (error) {
            console.error(error);
            return [];
        }
    }

    async function fetchAndDisplayVideos() {
        const videos = await fetchVideos();
        const videoMap = {};

        // Agrupar vídeos por nome (ou outro critério)
        [videos].forEach(video => {
            const name = video.filename.replace(/\.part\d+$/, ''); // Remove o número da parte
            if (!videoMap[name]) {
                videoMap[name] = [];
            }
            videoMap[name].push(video.data); // Adiciona os dados da parte
        });

        const videoContainer = document.getElementById('video-container');

        // Criar um elemento de vídeo para cada vídeo completo
        for (const [name, parts] of Object.entries(videoMap)) {
            const completeVideoData = parts.join(''); // Concatena os dados base64

            const videoElement = document.createElement('video');
            videoElement.src = `data:video/mp4;base64,${completeVideoData}`; // Usando o dado em base64
            videoElement.controls = true;

            const titleElement = document.createElement('h4');
            titleElement.innerText = name;

            videoContainer.appendChild(titleElement);
            videoContainer.appendChild(videoElement);
        }
    }

    // Chame a função para exibir os vídeos quando a página carregar
    fetchAndDisplayVideos();
</script>

</body>
</html>
